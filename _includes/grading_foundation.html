<!-- ===================== GRADING FEATURE ===================== -->
<!-- This include provides full grading functionality: submission, grading view, and rubric management -->
<!-- Enable on any page by adding `grading: true` to front matter -->

<script>
// Global feature registry (safe)
  window.PageFeatures = window.PageFeatures || {};

  // âœ… FORCE ENABLE grading
  window.PageFeatures.grading = true;
</script>

@@ -45,55 +45,16 @@ <h1>ğŸ“Š Grading Dashboard</h1>
  </div>
</aside>

<!-- Rubric Modal -->
<div id="rubric-modal" class="rubric-modal" hidden>
  <div class="rubric-modal-inner" style="background:#111; color:#fff; padding:1rem; border:1px solid #63b3ed; border-radius:8px; width:400px; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:1100;">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
      <h2>Rubric</h2>
      <button id="rubric-close-btn" style="background:transparent; border:none; color:#fff; font-size:1.2rem; cursor:pointer;">&times;</button>




































    </header>
    <div id="rubric-content" class="rubric-content"></div>



  </div>
</div>

<script>
/* ===================== INIT ===================== */
@@ -130,7 +91,7 @@ <h1>ğŸ“Š Grading Dashboard</h1>
gradingToggle?.addEventListener("click", openGradingPanel);
gradingClose?.addEventListener("click", closeGradingPanel);

/* ESC to close grading panel */
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && !gradingPanel.hidden) {
    closeGradingPanel();
@@ -144,11 +105,22 @@ <h1>ğŸ“Š Grading Dashboard</h1>
  { student: "Student C", assignment: "HW1", score: "â€”", status: "Pending" },
];

/* ===================== RUBRIC TEMPLATE ===================== */
const rubricTemplate = [
  "Correct format",
  "Answered all questions",
  "Code runs without errors",
  "Comments included"
];

const rubricModal = document.getElementById("rubric-modal");
const rubricClose = document.getElementById("rubric-close-btn");
const rubricContent = document.getElementById("rubric-content");

/* ===================== TABLE RENDER + EDITABLE ===================== */
function renderGradingTable() {
  const container = document.getElementById("grading-content");


  container.innerHTML = `
    <input
      type="text"
@@ -163,6 +135,7 @@ <h1>ğŸ“Š Grading Dashboard</h1>
          <th style="border: 1px solid #63b3ed; padding: 0.5rem;">Assignment</th>
          <th style="border: 1px solid #63b3ed; padding: 0.5rem;">Score</th>
          <th style="border: 1px solid #63b3ed; padding: 0.5rem;">Status</th>
          <th style="border: 1px solid #63b3ed; padding: 0.5rem;">Rubric</th>
        </tr>
      </thead>
      <tbody id="grading-tbody"></tbody>
@@ -171,60 +144,100 @@ <h1>ğŸ“Š Grading Dashboard</h1>

  const tbody = document.getElementById("grading-tbody");


  function updateTable(filter = "") {
    const filteredData = gradingData.filter((row) =>
      row.student.toLowerCase().includes(filter.toLowerCase())
    );

    tbody.innerHTML = filteredData.map((row, index) => `
      <tr>
        <td style="border: 1px solid #63b3ed; padding: 0.5rem;">${row.student}</td>
        <td style="border: 1px solid #63b3ed; padding: 0.5rem;">${row.assignment}</td>
        <td style="border: 1px solid #63b3ed; padding: 0.5rem;">
          <input type="text" value="${row.score}" 
            style="width: 60px; background: #111; color: #fff; border: 1px solid #63b3ed; border-radius: 4px; padding: 2px;"
            data-index="${index}" class="score-input"
          />
        </td>
        <td style="border: 1px solid #63b3ed; padding: 0.5rem;">
          <select data-index="${index}" class="status-select"
            style="background: #111; color: #fff; border: 1px solid #63b3ed; border-radius: 4px; padding: 2px;">
            <option value="Pending" ${row.status === "Pending" ? "selected" : ""}>Pending</option>
            <option value="Graded" ${row.status === "Graded" ? "selected" : ""}>Graded</option>
          </select>
        </td>
        <td style="border: 1px solid #63b3ed; padding: 0.5rem;">
          <button class="rubric-btn" data-index="${index}" style="background:#2563eb;color:#fff;border:none;border-radius:6px;padding:2px 6px;cursor:pointer;">ğŸ“ Rubric</button>
        </td>
      </tr>
    `).join("");

    // Score input listener
    document.querySelectorAll(".score-input").forEach(input => {
      input.addEventListener("input", e => {
        const idx = e.target.dataset.index;
        gradingData[idx].score = e.target.value;
      });
    });

    // Status select listener
    document.querySelectorAll(".status-select").forEach(select => {
      select.addEventListener("change", e => {
        const idx = e.target.dataset.index;
        gradingData[idx].status = e.target.value;
      });
    });

    // Rubric button listener
    document.querySelectorAll(".rubric-btn").forEach(btn => {
      btn.addEventListener("click", e => {
        const idx = e.target.dataset.index;
        openRubricModal(idx);
      });
    });
  }


  updateTable();

  // Live search
  const searchInput = document.getElementById("grading-search");
  searchInput.addEventListener("input", e => {
    updateTable(e.target.value);
  });
}

/* ===================== RUBRIC MODAL FUNCTIONS ===================== */
function openRubricModal(studentIndex) {
  const student = gradingData[studentIndex];
  if (!student.rubric) student.rubric = {};

  rubricContent.innerHTML = rubricTemplate.map(item => `
    <label style="display:flex; align-items:center; margin-bottom:0.5rem;">
      <input type="checkbox" data-student="${studentIndex}" data-item="${item}" ${student.rubric[item] ? "checked" : ""}/>
      ${item}
    </label>
  `).join("");

  rubricModal.hidden = false;

  rubricContent.querySelectorAll("input[type=checkbox]").forEach(cb => {
    cb.addEventListener("change", e => {
      const sIdx = e.target.dataset.student;
      const item = e.target.dataset.item;
      gradingData[sIdx].rubric[item] = e.target.checked;
    });
  });
}

// Close rubric modal
rubricClose.addEventListener("click", () => {
  rubricModal.hidden = true;
});

// ESC closes rubric modal
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && !rubricModal.hidden) rubricModal.hidden = true;
});
</script>

<!-- ===================== END GRADING FEATURE ===================== -->